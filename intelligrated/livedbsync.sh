#/bin/bash

PASSWORD=FNUh5CvKce5y3PI
HOST=10.180.8.195
USER=intprod
DATABASE=int_redesign
DB_FILE=live_dump.sql
EXCLUDED_TABLES=(
_kn_actions
_kn_authmap
_kn_batch
_kn_block
_kn_block_custom
_kn_block_node_type
_kn_block_role
_kn_blocked_ips
_kn_cache
_kn_cache_block
_kn_cache_bootstrap
_kn_cache_field
_kn_cache_filter
_kn_cache_form
_kn_cache_image
_kn_cache_menu
_kn_cache_metatag
_kn_cache_page
_kn_cache_path
_kn_cache_token
_kn_cache_update
_kn_cache_variable
_kn_cache_views
_kn_cache_views_data
_kn_captcha_points
_kn_captcha_sessions
_kn_ckeditor_input_format
_kn_ckeditor_settings
_kn_comment
_kn_ctools_css_cache
_kn_ctools_object_cache
_kn_date_format_locale
_kn_date_format_type
_kn_date_formats
_kn_feeds_importer
_kn_feeds_item
_kn_feeds_log
_kn_feeds_push_subscriptions
_kn_feeds_source
_kn_feeds_tamper
_kn_field_config
_kn_field_config_instance
_kn_field_data_body
_kn_field_data_comment_body
_kn_field_data_field_address
_kn_field_data_field_author
_kn_field_data_field_banner
_kn_field_data_field_banner_text
_kn_field_data_field_benefits_image
_kn_field_data_field_benefits_list
_kn_field_data_field_body
_kn_field_data_field_cm_number_2
_kn_field_data_field_column_1
_kn_field_data_field_column_2
_kn_field_data_field_column_3
_kn_field_data_field_column_4
_kn_field_data_field_column_5
_kn_field_data_field_content_image_caption_1
_kn_field_data_field_content_image_caption_2
_kn_field_data_field_content_section_body
_kn_field_data_field_content_section_image_1
_kn_field_data_field_content_section_image_2
_kn_field_data_field_content_section_title
_kn_field_data_field_content_table_body
_kn_field_data_field_content_table_body_2
_kn_field_data_field_content_table_title
_kn_field_data_field_cover_image
_kn_field_data_field_custom_sidebar
_kn_field_data_field_customer_integrator_logo
_kn_field_data_field_date
_kn_field_data_field_detail_body
_kn_field_data_field_detail_extra
_kn_field_data_field_detail_image
_kn_field_data_field_detail_link
_kn_field_data_field_detail_title
_kn_field_data_field_detail_youtube_id
_kn_field_data_field_event
_kn_field_data_field_event_date
_kn_field_data_field_event_type
_kn_field_data_field_excerpt
_kn_field_data_field_expert_image
_kn_field_data_field_expert_link
_kn_field_data_field_expert_name
_kn_field_data_field_expert_title
_kn_field_data_field_fax
_kn_field_data_field_featured_case_study
_kn_field_data_field_featured_content
_kn_field_data_field_featured_event_image
_kn_field_data_field_featured_event_link
_kn_field_data_field_featured_event_text
_kn_field_data_field_featured_solution
_kn_field_data_field_featured_solution_image
_kn_field_data_field_featured_solution_link
_kn_field_data_field_featured_solution_text
_kn_field_data_field_featured_solution_title
_kn_field_data_field_features_image
_kn_field_data_field_features_list
_kn_field_data_field_file_image_alt_text
_kn_field_data_field_file_image_title_text
_kn_field_data_field_header_1
_kn_field_data_field_header_2
_kn_field_data_field_header_3
_kn_field_data_field_header_4
_kn_field_data_field_header_5
_kn_field_data_field_image
_kn_field_data_field_image_caption
_kn_field_data_field_is_in_photo_library
_kn_field_data_field_job_title
_kn_field_data_field_link
_kn_field_data_field_literature
_kn_field_data_field_logos
_kn_field_data_field_name
_kn_field_data_field_open_link_in_new_tab
_kn_field_data_field_pdf
_kn_field_data_field_phone
_kn_field_data_field_positioning_statement
_kn_field_data_field_press_releases
_kn_field_data_field_product_family
_kn_field_data_field_regional_operation_locatio
_kn_field_data_field_related
_kn_field_data_field_show_detail_anchors
_kn_field_data_field_slide
_kn_field_data_field_slideshow_image
_kn_field_data_field_splash_page_template
_kn_field_data_field_start_new_page
_kn_field_data_field_start_table_on_new_page
_kn_field_data_field_state
_kn_field_data_field_subtitle
_kn_field_data_field_tags
_kn_field_data_field_use_first_column_as_y_axis
_kn_field_data_field_video
_kn_field_data_field_video_caption
_kn_field_data_field_video_thumbnail
_kn_field_data_field_video_type
_kn_field_data_field_weight
_kn_field_data_field_youtube_id
_kn_field_group
_kn_field_revision_body
_kn_field_revision_comment_body
_kn_field_revision_field_address
_kn_field_revision_field_author
_kn_field_revision_field_banner
_kn_field_revision_field_banner_text
_kn_field_revision_field_benefits_image
_kn_field_revision_field_benefits_list
_kn_field_revision_field_body
_kn_field_revision_field_cm_number_2
_kn_field_revision_field_column_1
_kn_field_revision_field_column_2
_kn_field_revision_field_column_3
_kn_field_revision_field_column_4
_kn_field_revision_field_column_5
_kn_field_revision_field_content_image_caption_1
_kn_field_revision_field_content_image_caption_2
_kn_field_revision_field_content_section_body
_kn_field_revision_field_content_section_image_1
_kn_field_revision_field_content_section_image_2
_kn_field_revision_field_content_section_title
_kn_field_revision_field_content_table_body
_kn_field_revision_field_content_table_body_2
_kn_field_revision_field_content_table_title
_kn_field_revision_field_cover_image
_kn_field_revision_field_custom_sidebar
_kn_field_revision_field_customer_integrator_logo
_kn_field_revision_field_date
_kn_field_revision_field_detail_body
_kn_field_revision_field_detail_extra
_kn_field_revision_field_detail_image
_kn_field_revision_field_detail_link
_kn_field_revision_field_detail_title
_kn_field_revision_field_detail_youtube_id
_kn_field_revision_field_event
_kn_field_revision_field_event_date
_kn_field_revision_field_event_type
_kn_field_revision_field_excerpt
_kn_field_revision_field_expert_image
_kn_field_revision_field_expert_link
_kn_field_revision_field_expert_name
_kn_field_revision_field_expert_title
_kn_field_revision_field_fax
_kn_field_revision_field_featured_case_study
_kn_field_revision_field_featured_content
_kn_field_revision_field_featured_event_image
_kn_field_revision_field_featured_event_link
_kn_field_revision_field_featured_event_text
_kn_field_revision_field_featured_solution
_kn_field_revision_field_featured_solution_image
_kn_field_revision_field_featured_solution_link
_kn_field_revision_field_featured_solution_text
_kn_field_revision_field_featured_solution_title
_kn_field_revision_field_features_image
_kn_field_revision_field_features_list
_kn_field_revision_field_file_image_alt_text
_kn_field_revision_field_file_image_title_text
_kn_field_revision_field_header_1
_kn_field_revision_field_header_2
_kn_field_revision_field_header_3
_kn_field_revision_field_header_4
_kn_field_revision_field_header_5
_kn_field_revision_field_image
_kn_field_revision_field_image_caption
_kn_field_revision_field_is_in_photo_library
_kn_field_revision_field_job_title
_kn_field_revision_field_link
_kn_field_revision_field_literature
_kn_field_revision_field_logos
_kn_field_revision_field_name
_kn_field_revision_field_open_link_in_new_tab
_kn_field_revision_field_pdf
_kn_field_revision_field_phone
_kn_field_revision_field_positioning_statement
_kn_field_revision_field_press_releases
_kn_field_revision_field_product_family
_kn_field_revision_field_regional_operation_locatio
_kn_field_revision_field_related
_kn_field_revision_field_show_detail_anchors
_kn_field_revision_field_slide
_kn_field_revision_field_slideshow_image
_kn_field_revision_field_splash_page_template
_kn_field_revision_field_start_new_page
_kn_field_revision_field_start_table_on_new_page
_kn_field_revision_field_state
_kn_field_revision_field_subtitle
_kn_field_revision_field_tags
_kn_field_revision_field_use_first_column_as_y_axis
_kn_field_revision_field_video
_kn_field_revision_field_video_caption
_kn_field_revision_field_video_thumbnail
_kn_field_revision_field_video_type
_kn_field_revision_field_weight
_kn_field_revision_field_youtube_id
_kn_file_display
_kn_file_managed
_kn_file_metadata
_kn_file_type
_kn_file_usage
_kn_filter
_kn_filter_format
_kn_flood
_kn_history
_kn_i18n_string
_kn_i18n_translation_set
_kn_image_effects
_kn_image_styles
_kn_job_schedule
_kn_languages
_kn_locales_source
_kn_locales_target
_kn_menu_custom
_kn_menu_links
_kn_menu_router
_kn_metatag
_kn_metatag_config
_kn_node
_kn_node_access
_kn_node_comment_statistics
_kn_node_revision
_kn_node_type
_kn_queue
_kn_rdf_mapping
_kn_redirect
_kn_registry
_kn_registry_file
_kn_role
_kn_role_permission
_kn_search_dataset
_kn_search_index
_kn_search_node_links
_kn_search_total
_kn_semaphore
_kn_sequences
_kn_sessions
_kn_shortcut_set
_kn_shortcut_set_users
_kn_system
_kn_taxonomy_index
_kn_taxonomy_term_data
_kn_taxonomy_term_hierarchy
_kn_taxonomy_vocabulary
_kn_url_alias
_kn_users
_kn_users_roles
_kn_variable
_kn_views_display
_kn_views_view
_kn_watchdog
_kn_webform
_kn_webform_component
_kn_webform_emails
_kn_webform_last_download
_kn_webform_roles
_kn_webform_submissions
_kn_webform_submitted_data
_kn_wysiwyg
_kn_wysiwyg_user
)

rm ${DB_FILE};

IGNORED_TABLES_STRING=''
for TABLE in "${EXCLUDED_TABLES[@]}"
do :
   IGNORED_TABLES_STRING+=" --ignore-table=${DATABASE}.${TABLE}"
done

echo "Dump structure"
ssh intelligrated mysqldump --host=${HOST} --user=${USER} --password=${PASSWORD} --single-transaction --no-data ${DATABASE} > ${DB_FILE}

echo "Dump content"
ssh intelligrated mysqldump --host=${HOST} --user=${USER} --password=${PASSWORD} --single-transaction --quick ${DATABASE} ${IGNORED_TABLES_STRING} >> ${DB_FILE}

drush sql-create -y;

echo "importing db"

mysql -uroot -proot intelligrated < ${DB_FILE};